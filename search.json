[
  {
    "objectID": "core.html",
    "href": "core.html",
    "title": "core",
    "section": "",
    "text": "source\n\nload_tif\n\n load_tif (fpath:Union[str,pathlib.Path], chnls_last=True)\n\nLoads a geotiff file, transpose its channels if necessary, and return the image data as a numpy array.\n\nParameters\n\nfpath (str|pathlib.Path): The file path of the image to be loaded.\nchnls_last (bool, optional): If set to True, the function will return the image data in the format (height, width, channels) (h, w, c). If set to False, the function will return the image data in the format (channels, height, width) (c, h, w). Default value is True.\n\n\n\nReturns\n\nnumpy.ndarray: The image data as a NumPy array. The shape of the array depends on the value of chnls_last.\n\nIf chnls_last is True, the returned array will have the shape (height, width, channels).\nIf chnls_last is False, the returned array will have the shape (channels, height, width).\n\n\n\n\n\n\n\n\n\n\n\n\nType\nDefault\nDetails\n\n\n\n\nfpath\nUnion\n\nfile path of the image to be loaded\n\n\nchnls_last\nbool\nTrue\ntranspose from c,h,w to h,w,c (assume c,h,w on rio.read input)\n\n\nReturns\nndarray\n\nndarray will return either h,w,c or c,h,w depending on chnls_last is True or False\n\n\n\n\n\nExplore loading geotiffs\n\nfrom torchgeo.datasets import EuroSAT100\nimport fastai.vision.all as fv\n\n\n# load a sample geotiff dataset\nsat_path = fv.untar_data(EuroSAT100.url); sat_path\n\nPath('/home/butch2/.fastai/data/EuroSAT100')\n\n\n\nsat_path.ls()\n\n(#1) [Path('/home/butch2/.fastai/data/EuroSAT100/images')]\n\n\n\nsat_images = fv.get_image_files(sat_path); len(sat_images)\n\n100\n\n\n\nsat_image = sat_images[10]; sat_image\n\nPath('/home/butch2/.fastai/data/EuroSAT100/images/remote_sensing/otherDatasets/sentinel_2/tif/River/River_2160.tif')\n\n\n\ndata = load_tif(sat_image) # channels last is the default\n(type(data), data.shape) # height,width, channels\n\n(numpy.ndarray, (64, 64, 13))\n\n\n\ndata = load_tif(sat_image, chnls_last=False)\ndata.shape # channels, height, width\n\n(13, 64, 64)\n\n\n\nsource\n\n\n\nopen_tif\n\n open_tif (fn:Union[str,pathlib.Path], chnls:[&lt;class'int'&gt;]=None,\n           chnls_last:bool=True, cls=&lt;class 'torch.Tensor'&gt;)\n\nCreates a tensor from a TIFF image file.\n\nParameters\n\nfn (str): The path to the TIFF image file.\nchnls (list of int, optional): The channels to load from the image. Default to None, which loads all channels\nchnls_last (bool, optional): If True, the channel dimension is the last dimension. Default to True.\ncls (class, optional): The class of the tensor to create. Defaults to torch.Tensor\n\n\n\nReturns\n\nTensor: A pytorch tensor created from the TIFF image file.\n\n\n\n\n\n\n\n\n\n\n\nType\nDefault\nDetails\n\n\n\n\nfn\nUnion\n\nThe path to the TIFF image file\n\n\nchnls\n[&lt;class ‘int’&gt;]\nNone\nThe channels to load from the image\n\n\nchnls_last\nbool\nTrue\nIf True, the channel dimension is the last dimension\n\n\ncls\n_TensorMeta\nTensor\nThe class of the tensor to create\n\n\nReturns\nTensor\n\nA tensor array of the image\n\n\n\n\n\nLoading geotiffs as Tensors\n\nt1 = open_tif(sat_image)\n\n\n(type(t1), t1.shape)\n\n(torch.Tensor, torch.Size([64, 64, 13]))\n\n\n\nsource\n\n\n\nGeoTensorImage\n\n GeoTensorImage (x, chnls_first=False)\n\nA TensorImage for geotiffs\nCan contain more than 3 channels (e.g. 12 band sentinel-2 images) as well as a bigger range of values (16-bit vs 8-bit) than your typical image formats\n\nAttributes\n\nchnls_first (bool): If True, the format of the tensor is c,h,w else its h,w,c where c = channels, h = height, w = width\n\n\n\nMethods\n\ncreate(data, chnls, chnls_first): (classmethod) create a GeoTensorImage from a file or numpy array\nshow(chnls,scaler,bright, ctx): display a GeoTensorImage\n\n\nGeoTensorImage.create?\n\n\nSignature:\nGeoTensorImage.create(\n    data: Union[pathlib.Path, str, numpy.ndarray],\n    chnls: [&lt;class 'int'&gt;] = None,\n    chnls_first: bool = True,\n) -&gt; fastai.torch_core.TensorImage\nDocstring:\n(class method) Returns an instance of the class with the input image data formatted appropriately. \nIf input is Path/str and ends with \"tif\", opens it using open_tif function. \nIf input is np.ndarray, transposes it if chnls_first. \nOtherwise, input is used as is.\n## Parameters:\n- `data` (Union[Path, str, np.ndarray]): The image data that the class method is called on.\n- `chnls` ([int]): An optional list of channels to filter. Defaults to None, which does no filtering.\n- `chnls_first` (bool, optional): A boolean flag indicating whether the channels are in the first or last \n                                  dimension of the input array. Defaults to True.\n## Returns\n- GeoTensorImage: An instance of the GeoTensorImage class with appropriate image formatting.\nFile:      /tmp/ipykernel_21397/1243907552.py\nType:      method\n\n\n\n\n\nCreating GeoTensorImages from a file\n\ngeo_img = GeoTensorImage.create(sat_image)\n\n\ngeo_img\n\nGeoTensorImage: torch.Size([13, 64, 64])\n\n\n\ngeo_img.show?\n\n\nSignature:\ngeo_img.show(\n    chnls: [&lt;class 'int'&gt;] = [3, 2, 1],\n    scaler: float = 1.0,\n    bright: float = 1.0,\n    ctx: matplotlib.axes._axes.Axes = None,\n) -&gt; matplotlib.image.AxesImage\nDocstring:\nShows the GeoTensorImage object in a matplotlib figure.\nArgs:\n    chnls: A list of channel indices to show. The default is [3, 2, 1].\n    scaler: A float value to scale the image by. The default is 1.0.\n    bright: A float value to brighten the image by. The default is 1.0.\n    ctx: A matplotlib context object. The default is None.\nReturns:\n    The matplotlib Axes image.\nFile:      /tmp/ipykernel_21397/1243907552.py\nType:      method\n\n\n\n\n\nShowing GeoTensorImages\n\ngeo_img.show();\n\n\n\n\n\ngeo_img.show(bright=1.7);\n\n\n\n\n\ngeo_img.show(scaler=0.7);\n\n\n\n\n\ngeo_img.show(scaler=0.7, bright=1.7);\n\n\n\n\n\nfig,ax = plt.subplots(1, 2, figsize=(10,10))\ngeo_img.show(ctx=ax[0])\ngeo_img.show(ctx=ax[1], scaler=0.4)\nplt.show()"
  },
  {
    "objectID": "tutorials/03-eurosat-classification.html",
    "href": "tutorials/03-eurosat-classification.html",
    "title": "EuroSAT Land Use/Land Cover (LULC) Classification Tutorial",
    "section": "",
    "text": "This is tutorial on finetuning a pretrained torchgeo resnet model on the torchgeo EuroSAT dataset using the fastai framework."
  },
  {
    "objectID": "tutorials/03-eurosat-classification.html#installation",
    "href": "tutorials/03-eurosat-classification.html#installation",
    "title": "EuroSAT Land Use/Land Cover (LULC) Classification Tutorial",
    "section": "Installation",
    "text": "Installation\nInstall the package\npip install git+https://github.com/butchland/fastai-torchgeo.git"
  },
  {
    "objectID": "tutorials/03-eurosat-classification.html#import-the-packages-and-download-the-eurosat-dataset",
    "href": "tutorials/03-eurosat-classification.html#import-the-packages-and-download-the-eurosat-dataset",
    "title": "EuroSAT Land Use/Land Cover (LULC) Classification Tutorial",
    "section": "Import the packages and download the EuroSAT dataset",
    "text": "Import the packages and download the EuroSAT dataset\n\nfrom torchgeo.datasets import EuroSAT\nfrom torchgeo.datamodules import EuroSATDataModule \nfrom torchgeo.models import ResNet50_Weights, resnet50\n\nimport fastai.vision.all as fv\n\nfrom fastai_torchgeo.data import GeoImageBlock\nfrom fastai_torchgeo.resnet import make_resnet_model, resnet_split"
  },
  {
    "objectID": "tutorials/03-eurosat-classification.html#create-a-fastai-datablock-and-fastai-dataloaders",
    "href": "tutorials/03-eurosat-classification.html#create-a-fastai-datablock-and-fastai-dataloaders",
    "title": "EuroSAT Land Use/Land Cover (LULC) Classification Tutorial",
    "section": "Create a fastai datablock and fastai dataloaders",
    "text": "Create a fastai datablock and fastai dataloaders\n\nbatch_size=64\nnum_workers = fv.defaults.cpus\ndset_name = 'EuroSAT'\n\n\ndblock = fv.DataBlock(blocks=(GeoImageBlock(), fv.CategoryBlock()),\n                      get_items=fv.get_image_files,\n                      splitter=fv.RandomSplitter(valid_pct=0.2, seed=42),\n                      get_y=fv.parent_label,\n                      item_tfms=fv.Resize(64),\n                      batch_tfms=[fv.Normalize.from_stats(EuroSATDataModule.mean, EuroSATDataModule.std)],\n                     )\n\n\ncfg = fv.fastai_cfg()\ndata_dir = cfg.path('data')\ndset_path = data_dir/dset_name\n\n\ndatamodule = EuroSATDataModule(root=dset_path,batch_size=batch_size, num_workers=num_workers, download=True)\n\n\ndatamodule.prepare_data()\n\nCPU times: user 72.8 ms, sys: 8.16 ms, total: 80.9 ms\nWall time: 80.2 ms\n\n\n\ndblock.summary(dset_path, show_batch=True)\n\nSetting-up type transforms pipelines\nCollecting items from /home/studio-lab-user/.fastai/data/EuroSAT\nFound 27000 items\n2 datasets of sizes 21600,5400\nSetting up Pipeline: partial\nSetting up Pipeline: parent_label -&gt; Categorize -- {'vocab': None, 'sort': True, 'add_na': False}\n\nBuilding one sample\n  Pipeline: partial\n    starting from\n      /home/studio-lab-user/.fastai/data/EuroSAT/ds/images/remote_sensing/otherDatasets/sentinel_2/tif/Highway/Highway_427.tif\n    applying partial gives\n      GeoTensorImage of size 13x64x64\n  Pipeline: parent_label -&gt; Categorize -- {'vocab': None, 'sort': True, 'add_na': False}\n    starting from\n      /home/studio-lab-user/.fastai/data/EuroSAT/ds/images/remote_sensing/otherDatasets/sentinel_2/tif/Highway/Highway_427.tif\n    applying parent_label gives\n      Highway\n    applying Categorize -- {'vocab': None, 'sort': True, 'add_na': False} gives\n      TensorCategory(3)\n\nFinal sample: (GeoTensorImage: torch.Size([13, 64, 64]), TensorCategory(3))\n\n\nCollecting items from /home/studio-lab-user/.fastai/data/EuroSAT\nFound 27000 items\n2 datasets of sizes 21600,5400\nSetting up Pipeline: partial\nSetting up Pipeline: parent_label -&gt; Categorize -- {'vocab': None, 'sort': True, 'add_na': False}\nSetting up after_item: Pipeline: Resize -- {'size': (64, 64), 'method': 'crop', 'pad_mode': 'reflection', 'resamples': (&lt;Resampling.BILINEAR: 2&gt;, &lt;Resampling.NEAREST: 0&gt;), 'p': 1.0} -&gt; ToTensor\nSetting up before_batch: Pipeline: \nSetting up after_batch: Pipeline: Normalize -- {'mean': tensor([[[[1354.4055]],\n\n         [[1118.2440]],\n\n         [[1042.9298]],\n\n         [[ 947.6262]],\n\n         [[1199.4729]],\n\n         [[1999.7909]],\n\n         [[2369.2229]],\n\n         [[2296.8262]],\n\n         [[ 732.0834]],\n\n         [[  12.1133]],\n\n         [[1819.0103]],\n\n         [[1118.9240]],\n\n         [[2594.1409]]]], device='cuda:0'), 'std': tensor([[[[ 245.7176]],\n\n         [[ 333.0078]],\n\n         [[ 395.0925]],\n\n         [[ 593.7505]],\n\n         [[ 566.4170]],\n\n         [[ 861.1840]],\n\n         [[1086.6313]],\n\n         [[1117.9817]],\n\n         [[ 404.9198]],\n\n         [[   4.7758]],\n\n         [[1002.5877]],\n\n         [[ 761.3032]],\n\n         [[1231.5858]]]], device='cuda:0'), 'axes': (0, 2, 3)}\n\nBuilding one batch\nApplying item_tfms to the first sample:\n  Pipeline: Resize -- {'size': (64, 64), 'method': 'crop', 'pad_mode': 'reflection', 'resamples': (&lt;Resampling.BILINEAR: 2&gt;, &lt;Resampling.NEAREST: 0&gt;), 'p': 1.0} -&gt; ToTensor\n    starting from\n      (GeoTensorImage of size 13x64x64, TensorCategory(3))\n    applying Resize -- {'size': (64, 64), 'method': 'crop', 'pad_mode': 'reflection', 'resamples': (&lt;Resampling.BILINEAR: 2&gt;, &lt;Resampling.NEAREST: 0&gt;), 'p': 1.0} gives\n      (GeoTensorImage of size 13x64x64, TensorCategory(3))\n    applying ToTensor gives\n      (GeoTensorImage of size 13x64x64, TensorCategory(3))\n\nAdding the next 3 samples\n\nNo before_batch transform to apply\n\nCollating items in a batch\n\nApplying batch_tfms to the batch built\n  Pipeline: Normalize -- {'mean': tensor([[[[1354.4055]],\n\n         [[1118.2440]],\n\n         [[1042.9298]],\n\n         [[ 947.6262]],\n\n         [[1199.4729]],\n\n         [[1999.7909]],\n\n         [[2369.2229]],\n\n         [[2296.8262]],\n\n         [[ 732.0834]],\n\n         [[  12.1133]],\n\n         [[1819.0103]],\n\n         [[1118.9240]],\n\n         [[2594.1409]]]], device='cuda:0'), 'std': tensor([[[[ 245.7176]],\n\n         [[ 333.0078]],\n\n         [[ 395.0925]],\n\n         [[ 593.7505]],\n\n         [[ 566.4170]],\n\n         [[ 861.1840]],\n\n         [[1086.6313]],\n\n         [[1117.9817]],\n\n         [[ 404.9198]],\n\n         [[   4.7758]],\n\n         [[1002.5877]],\n\n         [[ 761.3032]],\n\n         [[1231.5858]]]], device='cuda:0'), 'axes': (0, 2, 3)}\n    starting from\n      (GeoTensorImage of size 4x13x64x64, TensorCategory([3, 0, 7, 1], device='cuda:0'))\n    applying Normalize -- {'mean': tensor([[[[1354.4055]],\n\n         [[1118.2440]],\n\n         [[1042.9298]],\n\n         [[ 947.6262]],\n\n         [[1199.4729]],\n\n         [[1999.7909]],\n\n         [[2369.2229]],\n\n         [[2296.8262]],\n\n         [[ 732.0834]],\n\n         [[  12.1133]],\n\n         [[1819.0103]],\n\n         [[1118.9240]],\n\n         [[2594.1409]]]], device='cuda:0'), 'std': tensor([[[[ 245.7176]],\n\n         [[ 333.0078]],\n\n         [[ 395.0925]],\n\n         [[ 593.7505]],\n\n         [[ 566.4170]],\n\n         [[ 861.1840]],\n\n         [[1086.6313]],\n\n         [[1117.9817]],\n\n         [[ 404.9198]],\n\n         [[   4.7758]],\n\n         [[1002.5877]],\n\n         [[ 761.3032]],\n\n         [[1231.5858]]]], device='cuda:0'), 'axes': (0, 2, 3)} gives\n      (GeoTensorImage of size 4x13x64x64, TensorCategory([3, 0, 7, 1], device='cuda:0'))\n\n\n\n\n\n\ndls = dblock.dataloaders(dset_path, bs=batch_size)\n\n\ndls.show_batch()"
  },
  {
    "objectID": "tutorials/03-eurosat-classification.html#download-the-torchgeo-pretrained-resnet-model-and-prepare-a-fastai-compatible-model",
    "href": "tutorials/03-eurosat-classification.html#download-the-torchgeo-pretrained-resnet-model-and-prepare-a-fastai-compatible-model",
    "title": "EuroSAT Land Use/Land Cover (LULC) Classification Tutorial",
    "section": "Download the torchgeo pretrained resnet model and prepare a fastai compatible model",
    "text": "Download the torchgeo pretrained resnet model and prepare a fastai compatible model\n\npretrained = resnet50(ResNet50_Weights.SENTINEL2_ALL_MOCO, num_classes=10) # load pretrained weights\n\n\nmodel = make_resnet_model(pretrained, n_out=10)"
  },
  {
    "objectID": "tutorials/03-eurosat-classification.html#create-a-fastai-learner",
    "href": "tutorials/03-eurosat-classification.html#create-a-fastai-learner",
    "title": "EuroSAT Land Use/Land Cover (LULC) Classification Tutorial",
    "section": "Create a fastai learner",
    "text": "Create a fastai learner\n\nlearn = fv.Learner(\n    dls, \n    model,\n    loss_func=fv.CrossEntropyLossFlat(),\n    metrics=[fv.accuracy],\n    splitter=resnet_split,\n)\n# freeze uses parameter groups created by `resnet_split` \n# to lock parameters of pretrained model except for the model head\n\nlearn.freeze()\n\n\n# note: only head parameter group is trainable (except BatchNorm layers w/ch are always trainable)\nlearn.summary()\n\n\n\n\n\n\n\n\nSequential (Input shape: 64 x 13 x 64 x 64)\n============================================================================\nLayer (type)         Output Shape         Param #    Trainable \n============================================================================\n                     64 x 64 x 32 x 32   \nConv2d                                    40768      False     \nBatchNorm2d                               128        True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 64 x 16 x 16   \nMaxPool2d                                                      \nConv2d                                    4096       False     \nBatchNorm2d                               128        True      \nReLU                                                           \nConv2d                                    36864      False     \nBatchNorm2d                               128        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 256 x 16 x 16  \nConv2d                                    16384      False     \nBatchNorm2d                               512        True      \nReLU                                                           \nConv2d                                    16384      False     \nBatchNorm2d                               512        True      \n____________________________________________________________________________\n                     64 x 64 x 16 x 16   \nConv2d                                    16384      False     \nBatchNorm2d                               128        True      \nReLU                                                           \nConv2d                                    36864      False     \nBatchNorm2d                               128        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 256 x 16 x 16  \nConv2d                                    16384      False     \nBatchNorm2d                               512        True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 64 x 16 x 16   \nConv2d                                    16384      False     \nBatchNorm2d                               128        True      \nReLU                                                           \nConv2d                                    36864      False     \nBatchNorm2d                               128        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 256 x 16 x 16  \nConv2d                                    16384      False     \nBatchNorm2d                               512        True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 128 x 16 x 16  \nConv2d                                    32768      False     \nBatchNorm2d                               256        True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 128 x 8 x 8    \nConv2d                                    147456     False     \nBatchNorm2d                               256        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 512 x 8 x 8    \nConv2d                                    65536      False     \nBatchNorm2d                               1024       True      \nReLU                                                           \nConv2d                                    131072     False     \nBatchNorm2d                               1024       True      \n____________________________________________________________________________\n                     64 x 128 x 8 x 8    \nConv2d                                    65536      False     \nBatchNorm2d                               256        True      \nReLU                                                           \nConv2d                                    147456     False     \nBatchNorm2d                               256        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 512 x 8 x 8    \nConv2d                                    65536      False     \nBatchNorm2d                               1024       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 128 x 8 x 8    \nConv2d                                    65536      False     \nBatchNorm2d                               256        True      \nReLU                                                           \nConv2d                                    147456     False     \nBatchNorm2d                               256        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 512 x 8 x 8    \nConv2d                                    65536      False     \nBatchNorm2d                               1024       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 128 x 8 x 8    \nConv2d                                    65536      False     \nBatchNorm2d                               256        True      \nReLU                                                           \nConv2d                                    147456     False     \nBatchNorm2d                               256        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 512 x 8 x 8    \nConv2d                                    65536      False     \nBatchNorm2d                               1024       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 256 x 8 x 8    \nConv2d                                    131072     False     \nBatchNorm2d                               512        True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 256 x 4 x 4    \nConv2d                                    589824     False     \nBatchNorm2d                               512        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 1024 x 4 x 4   \nConv2d                                    262144     False     \nBatchNorm2d                               2048       True      \nReLU                                                           \nConv2d                                    524288     False     \nBatchNorm2d                               2048       True      \n____________________________________________________________________________\n                     64 x 256 x 4 x 4    \nConv2d                                    262144     False     \nBatchNorm2d                               512        True      \nReLU                                                           \nConv2d                                    589824     False     \nBatchNorm2d                               512        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 1024 x 4 x 4   \nConv2d                                    262144     False     \nBatchNorm2d                               2048       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 256 x 4 x 4    \nConv2d                                    262144     False     \nBatchNorm2d                               512        True      \nReLU                                                           \nConv2d                                    589824     False     \nBatchNorm2d                               512        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 1024 x 4 x 4   \nConv2d                                    262144     False     \nBatchNorm2d                               2048       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 256 x 4 x 4    \nConv2d                                    262144     False     \nBatchNorm2d                               512        True      \nReLU                                                           \nConv2d                                    589824     False     \nBatchNorm2d                               512        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 1024 x 4 x 4   \nConv2d                                    262144     False     \nBatchNorm2d                               2048       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 256 x 4 x 4    \nConv2d                                    262144     False     \nBatchNorm2d                               512        True      \nReLU                                                           \nConv2d                                    589824     False     \nBatchNorm2d                               512        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 1024 x 4 x 4   \nConv2d                                    262144     False     \nBatchNorm2d                               2048       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 256 x 4 x 4    \nConv2d                                    262144     False     \nBatchNorm2d                               512        True      \nReLU                                                           \nConv2d                                    589824     False     \nBatchNorm2d                               512        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 1024 x 4 x 4   \nConv2d                                    262144     False     \nBatchNorm2d                               2048       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 512 x 4 x 4    \nConv2d                                    524288     False     \nBatchNorm2d                               1024       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 512 x 2 x 2    \nConv2d                                    2359296    False     \nBatchNorm2d                               1024       True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 2048 x 2 x 2   \nConv2d                                    1048576    False     \nBatchNorm2d                               4096       True      \nReLU                                                           \nConv2d                                    2097152    False     \nBatchNorm2d                               4096       True      \n____________________________________________________________________________\n                     64 x 512 x 2 x 2    \nConv2d                                    1048576    False     \nBatchNorm2d                               1024       True      \nReLU                                                           \nConv2d                                    2359296    False     \nBatchNorm2d                               1024       True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 2048 x 2 x 2   \nConv2d                                    1048576    False     \nBatchNorm2d                               4096       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 512 x 2 x 2    \nConv2d                                    1048576    False     \nBatchNorm2d                               1024       True      \nReLU                                                           \nConv2d                                    2359296    False     \nBatchNorm2d                               1024       True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 2048 x 2 x 2   \nConv2d                                    1048576    False     \nBatchNorm2d                               4096       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 2048 x 1 x 1   \nAdaptiveAvgPool2d                                              \nAdaptiveMaxPool2d                                              \n____________________________________________________________________________\n                     64 x 4096           \nFlatten                                                        \nBatchNorm1d                               8192       True      \nDropout                                                        \n____________________________________________________________________________\n                     64 x 512            \nLinear                                    2097152    True      \nReLU                                                           \nBatchNorm1d                               1024       True      \nDropout                                                        \n____________________________________________________________________________\n                     64 x 10             \nLinear                                    5120       True      \n____________________________________________________________________________\n\nTotal params: 25,650,880\nTotal trainable params: 2,164,608\nTotal non-trainable params: 23,486,272\n\nOptimizer used: &lt;function Adam&gt;\nLoss function: FlattenedLoss of CrossEntropyLoss()\n\nModel frozen up to parameter group #2\n\nCallbacks:\n  - TrainEvalCallback\n  - CastToTensor\n  - Recorder\n  - ProgressCallback"
  },
  {
    "objectID": "tutorials/03-eurosat-classification.html#train-the-model",
    "href": "tutorials/03-eurosat-classification.html#train-the-model",
    "title": "EuroSAT Land Use/Land Cover (LULC) Classification Tutorial",
    "section": "Train the model",
    "text": "Train the model\n\nlearn.lr_find()\n\n\n\n\n\n\n\n\nSuggestedLRs(valley=0.0006918309954926372)\n\n\n\n\n\n\nfrom fastai.callback.tracker import SaveModelCallback\nimport numpy as np\n\n\nlearn.fine_tune(10, freeze_epochs=3,base_lr=7e-4, cbs=[SaveModelCallback(monitor='accuracy',fname='euronet-resnet50-stage1')])\n\n\n\n\n\n\n\n\nepoch\ntrain_loss\nvalid_loss\naccuracy\ntime\n\n\n\n\n0\n0.494235\n0.293842\n0.907778\n00:41\n\n\n1\n0.333531\n0.231448\n0.921481\n00:41\n\n\n2\n0.239049\n0.184895\n0.939444\n00:41\n\n\n\n\n\nBetter model found at epoch 0 with accuracy value: 0.9077777862548828.\nBetter model found at epoch 1 with accuracy value: 0.9214814901351929.\nBetter model found at epoch 2 with accuracy value: 0.9394444227218628.\nBetter model found at epoch 0 with accuracy value: 0.959074079990387.\nBetter model found at epoch 1 with accuracy value: 0.9631481766700745.\nBetter model found at epoch 3 with accuracy value: 0.9688888788223267.\nBetter model found at epoch 4 with accuracy value: 0.9707407355308533.\nBetter model found at epoch 5 with accuracy value: 0.9722222089767456.\nBetter model found at epoch 6 with accuracy value: 0.9733333587646484.\nBetter model found at epoch 7 with accuracy value: 0.9740740656852722.\nBetter model found at epoch 9 with accuracy value: 0.9762963056564331.\n\n\n\n\n\n\n\n\n\nepoch\ntrain_loss\nvalid_loss\naccuracy\ntime\n\n\n\n\n0\n0.162829\n0.124671\n0.959074\n00:43\n\n\n1\n0.088713\n0.112167\n0.963148\n00:43\n\n\n2\n0.063464\n0.126567\n0.962037\n00:43\n\n\n3\n0.055648\n0.104110\n0.968889\n00:43\n\n\n4\n0.032861\n0.103171\n0.970741\n00:45\n\n\n5\n0.021249\n0.102579\n0.972222\n00:44\n\n\n6\n0.010938\n0.102371\n0.973333\n00:43\n\n\n7\n0.005382\n0.097377\n0.974074\n00:43\n\n\n8\n0.004003\n0.101503\n0.973889\n00:44\n\n\n9\n0.002489\n0.098339\n0.976296\n00:44\n\n\n\n\n\n\nlearn.save('euronet-resnet50-stage1-final')\n\nPath('models/euronet-resnet50-stage1-final.pth')\n\n\n\nlearn.recorder.plot_loss()\n\n\n\n\n\nlearn.summary()\n\n\n\n\n\n\n\n\nSequential (Input shape: 64 x 13 x 64 x 64)\n============================================================================\nLayer (type)         Output Shape         Param #    Trainable \n============================================================================\n                     64 x 64 x 32 x 32   \nConv2d                                    40768      True      \nBatchNorm2d                               128        True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 64 x 16 x 16   \nMaxPool2d                                                      \nConv2d                                    4096       True      \nBatchNorm2d                               128        True      \nReLU                                                           \nConv2d                                    36864      True      \nBatchNorm2d                               128        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 256 x 16 x 16  \nConv2d                                    16384      True      \nBatchNorm2d                               512        True      \nReLU                                                           \nConv2d                                    16384      True      \nBatchNorm2d                               512        True      \n____________________________________________________________________________\n                     64 x 64 x 16 x 16   \nConv2d                                    16384      True      \nBatchNorm2d                               128        True      \nReLU                                                           \nConv2d                                    36864      True      \nBatchNorm2d                               128        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 256 x 16 x 16  \nConv2d                                    16384      True      \nBatchNorm2d                               512        True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 64 x 16 x 16   \nConv2d                                    16384      True      \nBatchNorm2d                               128        True      \nReLU                                                           \nConv2d                                    36864      True      \nBatchNorm2d                               128        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 256 x 16 x 16  \nConv2d                                    16384      True      \nBatchNorm2d                               512        True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 128 x 16 x 16  \nConv2d                                    32768      True      \nBatchNorm2d                               256        True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 128 x 8 x 8    \nConv2d                                    147456     True      \nBatchNorm2d                               256        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 512 x 8 x 8    \nConv2d                                    65536      True      \nBatchNorm2d                               1024       True      \nReLU                                                           \nConv2d                                    131072     True      \nBatchNorm2d                               1024       True      \n____________________________________________________________________________\n                     64 x 128 x 8 x 8    \nConv2d                                    65536      True      \nBatchNorm2d                               256        True      \nReLU                                                           \nConv2d                                    147456     True      \nBatchNorm2d                               256        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 512 x 8 x 8    \nConv2d                                    65536      True      \nBatchNorm2d                               1024       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 128 x 8 x 8    \nConv2d                                    65536      True      \nBatchNorm2d                               256        True      \nReLU                                                           \nConv2d                                    147456     True      \nBatchNorm2d                               256        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 512 x 8 x 8    \nConv2d                                    65536      True      \nBatchNorm2d                               1024       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 128 x 8 x 8    \nConv2d                                    65536      True      \nBatchNorm2d                               256        True      \nReLU                                                           \nConv2d                                    147456     True      \nBatchNorm2d                               256        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 512 x 8 x 8    \nConv2d                                    65536      True      \nBatchNorm2d                               1024       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 256 x 8 x 8    \nConv2d                                    131072     True      \nBatchNorm2d                               512        True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 256 x 4 x 4    \nConv2d                                    589824     True      \nBatchNorm2d                               512        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 1024 x 4 x 4   \nConv2d                                    262144     True      \nBatchNorm2d                               2048       True      \nReLU                                                           \nConv2d                                    524288     True      \nBatchNorm2d                               2048       True      \n____________________________________________________________________________\n                     64 x 256 x 4 x 4    \nConv2d                                    262144     True      \nBatchNorm2d                               512        True      \nReLU                                                           \nConv2d                                    589824     True      \nBatchNorm2d                               512        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 1024 x 4 x 4   \nConv2d                                    262144     True      \nBatchNorm2d                               2048       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 256 x 4 x 4    \nConv2d                                    262144     True      \nBatchNorm2d                               512        True      \nReLU                                                           \nConv2d                                    589824     True      \nBatchNorm2d                               512        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 1024 x 4 x 4   \nConv2d                                    262144     True      \nBatchNorm2d                               2048       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 256 x 4 x 4    \nConv2d                                    262144     True      \nBatchNorm2d                               512        True      \nReLU                                                           \nConv2d                                    589824     True      \nBatchNorm2d                               512        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 1024 x 4 x 4   \nConv2d                                    262144     True      \nBatchNorm2d                               2048       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 256 x 4 x 4    \nConv2d                                    262144     True      \nBatchNorm2d                               512        True      \nReLU                                                           \nConv2d                                    589824     True      \nBatchNorm2d                               512        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 1024 x 4 x 4   \nConv2d                                    262144     True      \nBatchNorm2d                               2048       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 256 x 4 x 4    \nConv2d                                    262144     True      \nBatchNorm2d                               512        True      \nReLU                                                           \nConv2d                                    589824     True      \nBatchNorm2d                               512        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 1024 x 4 x 4   \nConv2d                                    262144     True      \nBatchNorm2d                               2048       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 512 x 4 x 4    \nConv2d                                    524288     True      \nBatchNorm2d                               1024       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 512 x 2 x 2    \nConv2d                                    2359296    True      \nBatchNorm2d                               1024       True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 2048 x 2 x 2   \nConv2d                                    1048576    True      \nBatchNorm2d                               4096       True      \nReLU                                                           \nConv2d                                    2097152    True      \nBatchNorm2d                               4096       True      \n____________________________________________________________________________\n                     64 x 512 x 2 x 2    \nConv2d                                    1048576    True      \nBatchNorm2d                               1024       True      \nReLU                                                           \nConv2d                                    2359296    True      \nBatchNorm2d                               1024       True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 2048 x 2 x 2   \nConv2d                                    1048576    True      \nBatchNorm2d                               4096       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 512 x 2 x 2    \nConv2d                                    1048576    True      \nBatchNorm2d                               1024       True      \nReLU                                                           \nConv2d                                    2359296    True      \nBatchNorm2d                               1024       True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \n____________________________________________________________________________\n                     64 x 2048 x 2 x 2   \nConv2d                                    1048576    True      \nBatchNorm2d                               4096       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 2048 x 1 x 1   \nAdaptiveAvgPool2d                                              \nAdaptiveMaxPool2d                                              \n____________________________________________________________________________\n                     64 x 4096           \nFlatten                                                        \nBatchNorm1d                               8192       True      \nDropout                                                        \n____________________________________________________________________________\n                     64 x 512            \nLinear                                    2097152    True      \nReLU                                                           \nBatchNorm1d                               1024       True      \nDropout                                                        \n____________________________________________________________________________\n                     64 x 10             \nLinear                                    5120       True      \n____________________________________________________________________________\n\nTotal params: 25,650,880\nTotal trainable params: 25,650,880\nTotal non-trainable params: 0\n\nOptimizer used: &lt;function Adam&gt;\nLoss function: FlattenedLoss of CrossEntropyLoss()\n\nModel unfrozen\n\nCallbacks:\n  - TrainEvalCallback\n  - CastToTensor\n  - Recorder\n  - ProgressCallback\n\n\n\nlearn.fit_one_cycle(20, lr_max=slice(3e-3, 6e-6), cbs=[SaveModelCallback(monitor='accuracy',fname='euronet-resnet50-stage2')])\n\n\n\n\n\n\n\n\nepoch\ntrain_loss\nvalid_loss\naccuracy\ntime\n\n\n\n\n0\n0.035239\n0.170115\n0.959259\n00:44\n\n\n1\n0.154670\n0.230367\n0.944815\n00:44\n\n\n2\n0.207444\n0.338804\n0.908889\n00:44\n\n\n3\n0.170779\n0.218512\n0.938704\n00:44\n\n\n4\n0.176847\n0.216765\n0.937593\n00:44\n\n\n5\n0.159534\n0.193209\n0.940926\n00:44\n\n\n6\n0.120023\n0.179367\n0.944444\n00:44\n\n\n7\n0.095654\n0.156686\n0.953148\n00:44\n\n\n8\n0.069015\n0.181001\n0.948519\n00:44\n\n\n9\n0.053350\n0.164088\n0.952222\n00:44\n\n\n10\n0.036882\n0.124723\n0.964630\n00:43\n\n\n11\n0.021793\n0.099748\n0.972963\n00:43\n\n\n12\n0.014808\n0.104900\n0.972593\n00:44\n\n\n13\n0.009095\n0.113750\n0.973148\n00:44\n\n\n14\n0.004226\n0.097392\n0.976111\n00:44\n\n\n15\n0.003125\n0.097975\n0.976852\n00:44\n\n\n16\n0.001740\n0.090906\n0.977593\n00:44\n\n\n17\n0.002263\n0.085452\n0.979444\n00:44\n\n\n18\n0.000893\n0.086279\n0.980185\n00:44\n\n\n19\n0.000644\n0.087188\n0.979444\n00:44\n\n\n\n\n\nBetter model found at epoch 0 with accuracy value: 0.9592592716217041.\nBetter model found at epoch 10 with accuracy value: 0.9646296501159668.\nBetter model found at epoch 11 with accuracy value: 0.9729629755020142.\nBetter model found at epoch 13 with accuracy value: 0.9731481671333313.\nBetter model found at epoch 14 with accuracy value: 0.976111114025116.\nBetter model found at epoch 15 with accuracy value: 0.9768518805503845.\nBetter model found at epoch 16 with accuracy value: 0.9775925874710083.\nBetter model found at epoch 17 with accuracy value: 0.9794444441795349.\nBetter model found at epoch 18 with accuracy value: 0.9801852107048035."
  },
  {
    "objectID": "tutorials/03-eurosat-classification.html#post-training-error-analysis-and-setting-up-for-inference",
    "href": "tutorials/03-eurosat-classification.html#post-training-error-analysis-and-setting-up-for-inference",
    "title": "EuroSAT Land Use/Land Cover (LULC) Classification Tutorial",
    "section": "Post training (error analysis and setting up for inference)",
    "text": "Post training (error analysis and setting up for inference)\n\nlearn.recorder.plot_loss()\n\n\n\n\n\nlearn.save('euronet-resnet50-stage2-final')\n\nPath('models/euronet-resnet50-stage2-final.pth')\n\n\n\nlearn.validate()\n\n\n\n\n\n\n\n\n(#2) [0.08627868443727493,0.9801852107048035]\n\n\n\ninterp = fv.ClassificationInterpretation.from_learner(learn)\n\n\n\n\n\n\n\n\n\ninterp.plot_confusion_matrix()\n\n\n\n\n\n\n\n\n\n\n\n\ninterp.plot_top_losses(9)"
  },
  {
    "objectID": "resnet.html",
    "href": "resnet.html",
    "title": "resnet",
    "section": "",
    "text": "from torchgeo.datamodules import EuroSATDataModule\nfrom torchgeo.datasets import EuroSAT100\n\n\nsource\n\nmake_resnet_model\n\n make_resnet_model (model:torch.nn.modules.module.Module, n_out:int)\n\nCreates a ResNet model by cutting the fully connected (fc) layer of a pretrained ResNet model and replacing it with a new head.\nThe new head is created by concatenating adaptive pooling layers and a linear layer followed by an activation function. The new head is then appended to the cut model\n\nParameters\n\nmodel (torch.nn.Module): A pretrained ResNet model.\nn_out (int): The number of output classes.\n\n\n\nReturns\n\ntorch.nn.Module: The ResNet model with the new head.\n\n\n\n\n\n\n\n\n\n\nType\nDetails\n\n\n\n\nmodel\nModule\npretrained torchgeo model\n\n\nn_out\nint\nnumber of outputs\n\n\nReturns\nModule\nnew model with a new head for finetuning\n\n\n\n\nsource\n\n\n\nresnet_split\n\n resnet_split (m:torch.nn.modules.module.Module)\n\nSplits the resnet model parameters into parameter groups\nUsed by fastai for discriminative learning rates (finetuning)\n\nParameters\n\nm (nn.Module): Model\n\n\n\nReturns\n\n[torch.nn.Module] : A list of parameter groups\n\n\n\n\n\n\n\n\n\n\nType\nDetails\n\n\n\n\nm\nModule\nA model\n\n\nReturns\n[&lt;class ‘torch.nn.modules.module.Module’&gt;]\nA list of parameter groups\n\n\n\n\n\nAdapting a pretrained resnet torchgeo model for a fastai Learner\n\nfrom torchgeo.models import ResNet18_Weights, resnet18\nfrom torchgeo.datamodules import EuroSATDataModule\n\n\npretrained = resnet18(ResNet18_Weights.SENTINEL2_ALL_MOCO, num_classes=10) # load pretrained weights\n\n\nmodel = make_resnet_model(pretrained, n_out=10)\n\n\ndblock = fv.DataBlock(blocks=(GeoImageBlock(), fv.CategoryBlock()),\n                      get_items=fv.get_image_files,\n                      splitter=fv.RandomSplitter(valid_pct=0.1, seed=42),\n                      get_y=fv.parent_label,\n                      item_tfms=fv.Resize(64),\n                      batch_tfms=[fv.Normalize.from_stats(EuroSATDataModule.mean, EuroSATDataModule.std)],\n                     )\n\n\nsat_path = fv.untar_data(EuroSAT100.url)\n\n\ndls = dblock.dataloaders(sat_path, bs=64)\n\n\nmodel = make_resnet_model(pretrained, n_out=10)\n\n\nbatch_size=64\nnum_workers = fv.defaults.cpus\n\n\n# datamodule = EuroSATDataModule(root=sat_path,batch_size=batch_size, num_workers=num_workers, download=True)\n\n\n# %%time\n# datamodule.prepare_data()\n\n\nlearn = fv.Learner(\n    dls, \n    model,\n    loss_func=fv.CrossEntropyLossFlat(),\n    metrics=[fv.error_rate,fv.accuracy],\n    splitter=resnet_split,\n)\n# freeze uses parameter groups created by `resnet_split` \n# to lock parameters of pretrained model except for the model head\n\nlearn.freeze()\n\n\n# note: only head parameter group is trainable (except BatchNorm layers w/ch are always trainable)\nlearn.summary()\n\n\n\n\n\n\n\n\nSequential (Input shape: 64 x 13 x 64 x 64)\n============================================================================\nLayer (type)         Output Shape         Param #    Trainable \n============================================================================\n                     64 x 64 x 32 x 32   \nConv2d                                    40768      False     \nBatchNorm2d                               128        True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 64 x 16 x 16   \nMaxPool2d                                                      \nConv2d                                    36864      False     \nBatchNorm2d                               128        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \nConv2d                                    36864      False     \nBatchNorm2d                               128        True      \nReLU                                                           \nConv2d                                    36864      False     \nBatchNorm2d                               128        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \nConv2d                                    36864      False     \nBatchNorm2d                               128        True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 128 x 8 x 8    \nConv2d                                    73728      False     \nBatchNorm2d                               256        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \nConv2d                                    147456     False     \nBatchNorm2d                               256        True      \nReLU                                                           \nConv2d                                    8192       False     \nBatchNorm2d                               256        True      \nConv2d                                    147456     False     \nBatchNorm2d                               256        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \nConv2d                                    147456     False     \nBatchNorm2d                               256        True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 256 x 4 x 4    \nConv2d                                    294912     False     \nBatchNorm2d                               512        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \nConv2d                                    589824     False     \nBatchNorm2d                               512        True      \nReLU                                                           \nConv2d                                    32768      False     \nBatchNorm2d                               512        True      \nConv2d                                    589824     False     \nBatchNorm2d                               512        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \nConv2d                                    589824     False     \nBatchNorm2d                               512        True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 512 x 2 x 2    \nConv2d                                    1179648    False     \nBatchNorm2d                               1024       True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \nConv2d                                    2359296    False     \nBatchNorm2d                               1024       True      \nReLU                                                           \nConv2d                                    131072     False     \nBatchNorm2d                               1024       True      \nConv2d                                    2359296    False     \nBatchNorm2d                               1024       True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \nConv2d                                    2359296    False     \nBatchNorm2d                               1024       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 512 x 1 x 1    \nAdaptiveAvgPool2d                                              \nAdaptiveMaxPool2d                                              \n____________________________________________________________________________\n                     64 x 1024           \nFlatten                                                        \nBatchNorm1d                               2048       True      \nDropout                                                        \n____________________________________________________________________________\n                     64 x 512            \nLinear                                    524288     True      \nReLU                                                           \nBatchNorm1d                               1024       True      \nDropout                                                        \n____________________________________________________________________________\n                     64 x 10             \nLinear                                    5120       True      \n____________________________________________________________________________\n\nTotal params: 11,740,352\nTotal trainable params: 542,080\nTotal non-trainable params: 11,198,272\n\nOptimizer used: &lt;function Adam&gt;\nLoss function: FlattenedLoss of CrossEntropyLoss()\n\nModel frozen up to parameter group #2\n\nCallbacks:\n  - TrainEvalCallback\n  - CastToTensor\n  - Recorder\n  - ProgressCallback\n\n\n\nlearn.fine_tune(2)\n\n\n\n\n\n\n\n\nepoch\ntrain_loss\nvalid_loss\nerror_rate\naccuracy\ntime\n\n\n\n\n0\n4.042061\n2.311349\n0.800000\n0.200000\n00:01\n\n\n\n\n\n\n\n\n\n\n\n\nepoch\ntrain_loss\nvalid_loss\nerror_rate\naccuracy\ntime\n\n\n\n\n0\n3.859293\n2.302754\n1.000000\n0.000000\n00:02\n\n\n1\n3.652791\n2.247182\n0.900000\n0.100000\n00:02\n\n\n\n\n\n\n# unlock all weights and make the whole model trainable\nlearn.unfreeze()\n\n\n# all parameters are now trainable\nlearn.summary()\n\n\n\n\n\n\n\n\nSequential (Input shape: 64 x 13 x 64 x 64)\n============================================================================\nLayer (type)         Output Shape         Param #    Trainable \n============================================================================\n                     64 x 64 x 32 x 32   \nConv2d                                    40768      True      \nBatchNorm2d                               128        True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 64 x 16 x 16   \nMaxPool2d                                                      \nConv2d                                    36864      True      \nBatchNorm2d                               128        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \nConv2d                                    36864      True      \nBatchNorm2d                               128        True      \nReLU                                                           \nConv2d                                    36864      True      \nBatchNorm2d                               128        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \nConv2d                                    36864      True      \nBatchNorm2d                               128        True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 128 x 8 x 8    \nConv2d                                    73728      True      \nBatchNorm2d                               256        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \nConv2d                                    147456     True      \nBatchNorm2d                               256        True      \nReLU                                                           \nConv2d                                    8192       True      \nBatchNorm2d                               256        True      \nConv2d                                    147456     True      \nBatchNorm2d                               256        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \nConv2d                                    147456     True      \nBatchNorm2d                               256        True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 256 x 4 x 4    \nConv2d                                    294912     True      \nBatchNorm2d                               512        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \nConv2d                                    589824     True      \nBatchNorm2d                               512        True      \nReLU                                                           \nConv2d                                    32768      True      \nBatchNorm2d                               512        True      \nConv2d                                    589824     True      \nBatchNorm2d                               512        True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \nConv2d                                    589824     True      \nBatchNorm2d                               512        True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 512 x 2 x 2    \nConv2d                                    1179648    True      \nBatchNorm2d                               1024       True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \nConv2d                                    2359296    True      \nBatchNorm2d                               1024       True      \nReLU                                                           \nConv2d                                    131072     True      \nBatchNorm2d                               1024       True      \nConv2d                                    2359296    True      \nBatchNorm2d                               1024       True      \nIdentity                                                       \nReLU                                                           \nIdentity                                                       \nConv2d                                    2359296    True      \nBatchNorm2d                               1024       True      \nReLU                                                           \n____________________________________________________________________________\n                     64 x 512 x 1 x 1    \nAdaptiveAvgPool2d                                              \nAdaptiveMaxPool2d                                              \n____________________________________________________________________________\n                     64 x 1024           \nFlatten                                                        \nBatchNorm1d                               2048       True      \nDropout                                                        \n____________________________________________________________________________\n                     64 x 512            \nLinear                                    524288     True      \nReLU                                                           \nBatchNorm1d                               1024       True      \nDropout                                                        \n____________________________________________________________________________\n                     64 x 10             \nLinear                                    5120       True      \n____________________________________________________________________________\n\nTotal params: 11,740,352\nTotal trainable params: 11,740,352\nTotal non-trainable params: 0\n\nOptimizer used: &lt;function Adam&gt;\nLoss function: FlattenedLoss of CrossEntropyLoss()\n\nModel unfrozen\n\nCallbacks:\n  - TrainEvalCallback\n  - CastToTensor\n  - Recorder\n  - ProgressCallback\n\n\n\n# uses discriminative learning rates across parameter groups to give \n# the \"upper lavers\" higher learning rates while keeping the \"lower layers\"\n# to a lower learning rates, nearly freezing their weights.\nlearn.fit_one_cycle(5, lr_max=slice(2.e-3,8.e-6))\n\n\n\n\n\n\n\n\nepoch\ntrain_loss\nvalid_loss\nerror_rate\naccuracy\ntime\n\n\n\n\n0\n2.139503\n2.269313\n0.900000\n0.100000\n00:02\n\n\n1\n2.047539\n2.380141\n1.000000\n0.000000\n00:03\n\n\n2\n2.059563\n2.353606\n0.900000\n0.100000\n00:02\n\n\n3\n2.036056\n2.318051\n0.900000\n0.100000\n00:02\n\n\n4\n1.905594\n2.308228\n0.900000\n0.100000\n00:03"
  },
  {
    "objectID": "data.html",
    "href": "data.html",
    "title": "data",
    "section": "",
    "text": "source\n\nGeoImageBlock\n\n GeoImageBlock (chnls_first=True)\n\nReturns a TransformBlock that creates a GeoTensorImage object from an input image tensor.\n\nParameters\n\nchnls_first (bool, optional): A boolean indicating whether the input tensor has channels as the first dimension. Default is True.\n\n\n\nReturns\n\nfastai.transforms.TransformBlock : A TransformBlock object that applies GeoTensorImage.create on an input tensor or filename.\n\n\n\nCreate a fastai datablock with geotiffs\n\nfrom torchgeo.datamodules import EuroSATDataModule\nfrom torchgeo.datasets import EuroSAT100\nimport fastai.vision.all as fv\n\n\n# get sample geotiff dataset\nsat_path = fv.untar_data(EuroSAT100.url)\n\n\n# create a fastai datablock for geotiff classification \ndblock = fv.DataBlock(blocks=(GeoImageBlock(), fv.CategoryBlock()),\n                      get_items=fv.get_image_files,\n                      splitter=fv.RandomSplitter(valid_pct=0.1, seed=42),\n                      get_y=fv.parent_label,\n                      item_tfms=fv.Resize(64),\n                      batch_tfms=[fv.Normalize.from_stats(EuroSATDataModule.mean, EuroSATDataModule.std)],\n                     )\n\n\ndblock.summary(sat_path, show_batch=True)\n\nSetting-up type transforms pipelines\nCollecting items from /home/butch2/.fastai/data/EuroSAT100\nFound 100 items\n2 datasets of sizes 90,10\nSetting up Pipeline: partial\nSetting up Pipeline: parent_label -&gt; Categorize -- {'vocab': None, 'sort': True, 'add_na': False}\n\nBuilding one sample\n  Pipeline: partial\n    starting from\n      /home/butch2/.fastai/data/EuroSAT100/images/remote_sensing/otherDatasets/sentinel_2/tif/Industrial/Industrial_1906.tif\n    applying partial gives\n      GeoTensorImage of size 13x64x64\n  Pipeline: parent_label -&gt; Categorize -- {'vocab': None, 'sort': True, 'add_na': False}\n    starting from\n      /home/butch2/.fastai/data/EuroSAT100/images/remote_sensing/otherDatasets/sentinel_2/tif/Industrial/Industrial_1906.tif\n    applying parent_label gives\n      Industrial\n    applying Categorize -- {'vocab': None, 'sort': True, 'add_na': False} gives\n      TensorCategory(4)\n\nFinal sample: (GeoTensorImage: torch.Size([13, 64, 64]), TensorCategory(4))\n\n\nCollecting items from /home/butch2/.fastai/data/EuroSAT100\nFound 100 items\n2 datasets of sizes 90,10\nSetting up Pipeline: partial\nSetting up Pipeline: parent_label -&gt; Categorize -- {'vocab': None, 'sort': True, 'add_na': False}\nSetting up after_item: Pipeline: Resize -- {'size': (64, 64), 'method': 'crop', 'pad_mode': 'reflection', 'resamples': (&lt;Resampling.BILINEAR: 2&gt;, &lt;Resampling.NEAREST: 0&gt;), 'p': 1.0} -&gt; ToTensor\nSetting up before_batch: Pipeline: \nSetting up after_batch: Pipeline: Normalize -- {'mean': tensor([[[[1354.4055]],\n\n         [[1118.2440]],\n\n         [[1042.9298]],\n\n         [[ 947.6262]],\n\n         [[1199.4729]],\n\n         [[1999.7909]],\n\n         [[2369.2229]],\n\n         [[2296.8262]],\n\n         [[ 732.0834]],\n\n         [[  12.1133]],\n\n         [[1819.0103]],\n\n         [[1118.9240]],\n\n         [[2594.1409]]]]), 'std': tensor([[[[ 245.7176]],\n\n         [[ 333.0078]],\n\n         [[ 395.0925]],\n\n         [[ 593.7505]],\n\n         [[ 566.4170]],\n\n         [[ 861.1840]],\n\n         [[1086.6313]],\n\n         [[1117.9817]],\n\n         [[ 404.9198]],\n\n         [[   4.7758]],\n\n         [[1002.5877]],\n\n         [[ 761.3032]],\n\n         [[1231.5858]]]]), 'axes': (0, 2, 3)}\n\nBuilding one batch\nApplying item_tfms to the first sample:\n  Pipeline: Resize -- {'size': (64, 64), 'method': 'crop', 'pad_mode': 'reflection', 'resamples': (&lt;Resampling.BILINEAR: 2&gt;, &lt;Resampling.NEAREST: 0&gt;), 'p': 1.0} -&gt; ToTensor\n    starting from\n      (GeoTensorImage of size 13x64x64, TensorCategory(4))\n    applying Resize -- {'size': (64, 64), 'method': 'crop', 'pad_mode': 'reflection', 'resamples': (&lt;Resampling.BILINEAR: 2&gt;, &lt;Resampling.NEAREST: 0&gt;), 'p': 1.0} gives\n      (GeoTensorImage of size 13x64x64, TensorCategory(4))\n    applying ToTensor gives\n      (GeoTensorImage of size 13x64x64, TensorCategory(4))\n\nAdding the next 3 samples\n\nNo before_batch transform to apply\n\nCollating items in a batch\n\nApplying batch_tfms to the batch built\n  Pipeline: Normalize -- {'mean': tensor([[[[1354.4055]],\n\n         [[1118.2440]],\n\n         [[1042.9298]],\n\n         [[ 947.6262]],\n\n         [[1199.4729]],\n\n         [[1999.7909]],\n\n         [[2369.2229]],\n\n         [[2296.8262]],\n\n         [[ 732.0834]],\n\n         [[  12.1133]],\n\n         [[1819.0103]],\n\n         [[1118.9240]],\n\n         [[2594.1409]]]]), 'std': tensor([[[[ 245.7176]],\n\n         [[ 333.0078]],\n\n         [[ 395.0925]],\n\n         [[ 593.7505]],\n\n         [[ 566.4170]],\n\n         [[ 861.1840]],\n\n         [[1086.6313]],\n\n         [[1117.9817]],\n\n         [[ 404.9198]],\n\n         [[   4.7758]],\n\n         [[1002.5877]],\n\n         [[ 761.3032]],\n\n         [[1231.5858]]]]), 'axes': (0, 2, 3)}\n    starting from\n      (GeoTensorImage of size 4x13x64x64, TensorCategory([4, 3, 8, 8]))\n    applying Normalize -- {'mean': tensor([[[[1354.4055]],\n\n         [[1118.2440]],\n\n         [[1042.9298]],\n\n         [[ 947.6262]],\n\n         [[1199.4729]],\n\n         [[1999.7909]],\n\n         [[2369.2229]],\n\n         [[2296.8262]],\n\n         [[ 732.0834]],\n\n         [[  12.1133]],\n\n         [[1819.0103]],\n\n         [[1118.9240]],\n\n         [[2594.1409]]]]), 'std': tensor([[[[ 245.7176]],\n\n         [[ 333.0078]],\n\n         [[ 395.0925]],\n\n         [[ 593.7505]],\n\n         [[ 566.4170]],\n\n         [[ 861.1840]],\n\n         [[1086.6313]],\n\n         [[1117.9817]],\n\n         [[ 404.9198]],\n\n         [[   4.7758]],\n\n         [[1002.5877]],\n\n         [[ 761.3032]],\n\n         [[1231.5858]]]]), 'axes': (0, 2, 3)} gives\n      (GeoTensorImage of size 4x13x64x64, TensorCategory([4, 3, 8, 8]))\n\n\n\n\n\n\ndls = dblock.dataloaders(sat_path, bs=64)\n\n\ndls.show_batch()"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "fastai-torchgeo",
    "section": "",
    "text": "A fastai extension to use the torchgeo models and datasets"
  },
  {
    "objectID": "index.html#installation",
    "href": "index.html#installation",
    "title": "fastai-torchgeo",
    "section": "Installation",
    "text": "Installation\npip install git+https://github.com/butchland/fastai-torchgeo.git"
  },
  {
    "objectID": "index.html#general-information",
    "href": "index.html#general-information",
    "title": "fastai-torchgeo",
    "section": "General Information",
    "text": "General Information\nfastai-torchgeo provides adapters and utilities to enable the torchgeo package to be used alongside fastai. The goal is make it easier to use fastai for geospatial machine learning.\nIn addition to the utilities, we also provide examples of how to integrate torchgeo datasets and models into fastai workflows, such as EDA, training and inference.\nEach of fastai-torchgeo modules have their own page and you are encouraged to browse through them as they also provide usage examples.\nTo get a quick taste of what this package can do, take a look at the examples below.\n\nNote: All the pages in this site are written as jupyter notebooks that can be run on Google Colab. Just click on the  button near the top of each notebook (including this one!)."
  },
  {
    "objectID": "index.html#examples",
    "href": "index.html#examples",
    "title": "fastai-torchgeo",
    "section": "Examples",
    "text": "Examples\n\nLoading a tif file\n\nfrom torchgeo.datasets import EuroSAT100\nimport fastai.vision.all as fv\n\n# load a sample geotiff dataset\nsat_path = fv.untar_data(EuroSAT100.url)\nsat_images = fv.get_image_files(sat_path)\nsat_image = sat_images[15]; sat_image\n\nPath('/home/butch2/.fastai/data/EuroSAT100/images/remote_sensing/otherDatasets/sentinel_2/tif/River/River_458.tif')\n\n\n\nfrom fastai_torchgeo.core import load_tif, open_tif, GeoTensorImage\n\narr = load_tif(sat_image) \n(type(arr),arr.shape) # ndarray, (height,width, channels)\n\n(numpy.ndarray, (64, 64, 13))\n\n\n\n# load sat image as tensor\nt_img = open_tif(sat_image)\n(type(t_img), t_img.shape)\n\n(torch.Tensor, torch.Size([64, 64, 13]))\n\n\n\ngeo_t = GeoTensorImage.create(sat_image)\n(type(geo_t), geo_t.shape)\n\n(fastai_torchgeo.core.GeoTensorImage, torch.Size([13, 64, 64]))\n\n\n\n\nShowing geo tensor images\n\ngeo_t.show();"
  }
]